<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Head Chart</title>
    <!-- Load React from cdnjs -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <!-- Load Recharts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.js"></script>
    <!-- Load Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        .price {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 20px;
        }
        .chart-container {
            position: relative;
            height: calc(100vh - 100px);
            width: 100%;
        }
        .face {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            position: absolute;
            transition: all 0.3s ease-out;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Test that React is loaded
        console.log('React version:', React.version);
        // Test that Recharts is loaded
        console.log('Recharts loaded:', typeof Recharts !== 'undefined');

        const { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer } = Recharts;

        function App() {
            const [price, setPrice] = React.useState(null);
            const [priceHistory, setPriceHistory] = React.useState([]);

            // Fetch price data
            React.useEffect(() => {
                const fetchPrice = async () => {
                    try {
                        const response = await fetch(
                            'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd'
                        );
                        const data = await response.json();
                        if (data?.bitcoin?.usd) {
                            const newPrice = data.bitcoin.usd;
                            setPrice(newPrice);
                            setPriceHistory(prev => {
                                const newPoint = {
                                    time: new Date().toLocaleTimeString(),
                                    price: newPrice
                                };
                                return [...prev.slice(-19), newPoint];
                            });
                        }
                    } catch (error) {
                        console.error('Error:', error);
                    }
                };

                fetchPrice();
                const interval = setInterval(fetchPrice, 5000);
                return () => clearInterval(interval);
            }, []);

            return (
                <div>
                    <div className="price">
                        Bitcoin: ${price ? price.toLocaleString() : 'Loading...'}
                    </div>
                    <div className="chart-container">
                        {priceHistory.length > 0 && (
                            <ResponsiveContainer width="100%" height="100%">
                                <LineChart data={priceHistory}>
                                    <XAxis 
                                        dataKey="time"
                                        stroke="#fff"
                                    />
                                    <YAxis 
                                        stroke="#fff"
                                        tickFormatter={value => `$${value.toLocaleString()}`}
                                    />
                                    <Line 
                                        type="monotone"
                                        dataKey="price"
                                        stroke="#00ff00"
                                        strokeWidth={2}
                                        dot={false}
                                        isAnimationActive={false}
                                    />
                                </LineChart>
                            </ResponsiveContainer>
                        )}
                        <img 
                            src="images/IMG_3457.png"
                            alt="Floating head"
                            className="face"
                            style={{
                                top: price ? `${50}%` : '50%',
                                right: '20px',
                                transform: 'translateY(-50%)'
                            }}
                        />
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>