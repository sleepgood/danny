<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Head Chart</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        .container {
            position: relative;
            height: calc(100vh - 40px);
            width: 100%;
        }
        .face {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            position: absolute;
            transition: all 0.3s ease-out;
            z-index: 10;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .price {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer } = Recharts;

        const App = () => {
            const [price, setPrice] = React.useState(null);
            const [priceHistory, setPriceHistory] = React.useState([]);
            const [minMax, setMinMax] = React.useState({ min: 0, max: 0 });

            React.useEffect(() => {
                const fetchPrice = async () => {
                    try {
                        const response = await fetch(
                            'https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd',
                            {
                                method: 'GET',
                                headers: { 'Accept': 'application/json' }
                            }
                        );
                        
                        const data = await response.json();
                        
                        if (data?.bitcoin?.usd) {
                            const newPrice = data.bitcoin.usd;
                            const timestamp = new Date().getTime();
                            
                            setPrice(newPrice);
                            setPriceHistory(prev => {
                                const newHistory = [...prev, { timestamp, price: newPrice }];
                                if (newHistory.length > 50) newHistory.shift();
                                return newHistory;
                            });

                            // Update min/max with padding
                            const padding = newPrice * 0.001; // 0.1% padding
                            setMinMax(prev => ({
                                min: Math.min(prev.min || newPrice, newPrice) - padding,
                                max: Math.max(prev.max || newPrice, newPrice) + padding
                            }));
                        }
                    } catch (error) {
                        console.error('Error fetching price:', error);
                    }
                };

                fetchPrice();
                const interval = setInterval(fetchPrice, 5000); // Update every 5 seconds
                return () => clearInterval(interval);
            }, []);

            const formatTime = (timestamp) => {
                return new Date(timestamp).toLocaleTimeString();
            };

            const CustomTooltip = ({ active, payload }) => {
                if (active && payload && payload.length) {
                    return (
                        <div style={{ 
                            background: '#1a1a2e', 
                            border: '1px solid #fff',
                            padding: '10px',
                            borderRadius: '4px'
                        }}>
                            <p>{`Time: ${formatTime(payload[0].payload.timestamp)}`}</p>
                            <p>{`Price: $${payload[0].value.toLocaleString()}`}</p>
                        </div>
                    );
                }
                return null;
            };

            return (
                <div className="container">
                    <div className="price">
                        Bitcoin: ${price ? price.toLocaleString() : 'Loading...'}
                    </div>
                    <div style={{ position: 'relative', width: '100%', height: 'calc(100% - 100px)' }}>
                        {price && (
                            <img 
                                src="images/IMG_3457.png"
                                alt="Floating head"
                                className="face"
                                style={{
                                    top: `${100 - ((price - minMax.min) / (minMax.max - minMax.min) * 100)}%`,
                                    right: '20px',
                                    transform: 'translateY(-50%)'
                                }}
                            />
                        )}
                        <ResponsiveContainer width="100%" height="100%">
                            <LineChart 
                                data={priceHistory}
                                margin={{ top: 5, right: 50, left: 50, bottom: 5 }}
                            >
                                <XAxis 
                                    dataKey="timestamp"
                                    tickFormatter={formatTime}
                                    stroke="#fff"
                                    tick={{ fill: '#fff' }}
                                />
                                <YAxis 
                                    domain={[minMax.min, minMax.max]}
                                    tickFormatter={val => `$${val.toLocaleString()}`}
                                    stroke="#fff"
                                    tick={{ fill: '#fff' }}
                                />
                                <Tooltip content={<CustomTooltip />} />
                                <Line 
                                    type="monotone"
                                    dataKey="price"
                                    stroke="#00ff00"
                                    strokeWidth={2}
                                    dot={false}
                                    isAnimationActive={false}
                                />
                            </LineChart>
                        </ResponsiveContainer>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>